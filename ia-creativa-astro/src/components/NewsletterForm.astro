---
---

<div class="newsletter-form-container">
    <form id="newsletter-form" class="flex flex-col sm:flex-row gap-4 max-w-lg mx-auto">
        <input 
            type="email" 
            name="email" 
            placeholder="tu@email.com" 
            required
            class="flex-1 px-6 py-3 rounded-full text-gray-900 bg-white placeholder-gray-500 border-2 border-transparent focus:border-indigo-500 focus:outline-none"
        />
        <button 
            type="submit"
            class="px-8 py-3 font-bold text-indigo-900 bg-white rounded-full hover:bg-indigo-50 transition transform hover:scale-105"
        >
            Suscribirme
        </button>
    </form>
    <p id="form-message" class="mt-4 text-sm font-medium hidden"></p>
</div>

<script>
    const form = document.getElementById('newsletter-form') as HTMLFormElement;
    const message = document.getElementById('form-message') as HTMLParagraphElement;

    if (form) {
        form.addEventListener('submit', async (e) => {
            e.preventDefault();
            const formData = new FormData(form);
            const button = form.querySelector('button');
            
            if (button) {
                button.disabled = true;
                button.textContent = 'Enviando...';
            }

            try {
                const response = await fetch('/api/subscribe', {
                    method: 'POST',
                    body: formData,
                });

                const data = await response.json();

                if (response.ok) {
                    message.textContent = '¡Gracias por suscribirte! Revisa tu correo.';
                    message.classList.remove('hidden', 'text-red-400');
                    message.classList.add('text-green-400');
                    form.reset();
                } else {
                    throw new Error(data.message || 'Error desconocido');
                }
            } catch (error: any) {
                message.textContent = error.message || 'Hubo un error. Inténtalo de nuevo.';
                message.classList.remove('hidden', 'text-green-400');
                message.classList.add('text-red-400');
            } finally {
                if (button) {
                    button.disabled = false;
                    button.textContent = 'Suscribirme';
                }
            }
        });
    }
</script>
